<p>These are the instructions for installing RecordService in an existing Hadoop cluster. Using the RecordService VM is an alternative for those who want to quickly install and explore the features of RecordService.</p>

<p>See <a href="/vm.html">Download and Install RecordService VM</a>.</p>

<h2 id="download-recordservice">Download RecordService</h2>

<p>These are the ways you can install RecordService. Cloudera recommends that you install Cloudera Manager on your cluster, so that you can install RecordService as an add-on service in Cloudera Manager.</p>

<h2 id="installing-recordservice-as-an-add-on-service-in-cloudera-manager">Installing RecordService as an Add-on Service in Cloudera Manager</h2>

<p>You can install RecordService as an <a href="http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_mc_addon_services.html">Add-on Service</a> in Cloudera Manager. First, install both the CSD and the Parcel in Cloudera Manager; then, add RecordService as an add-on service from the home page in Cloudera Manager.
See <a href="http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_mc_addon_services.html">http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_mc_addon_services.html</a>.</p>

<h3 id="installing-the-recordservice-csd">Installing the RecordService CSD</h3>

<p>These are the steps to install the RecordService CSD.</p>

<ol>
  <li>Download the CSD from <a href="http://archive.cloudera.com/beta/recordservice/csd">http://archive.cloudera.com/beta/recordservice/csd</a>.</li>
  <li>Upload the CSD to <code>/opt/cloudera/csd</code> in the Cloudera Manager server.</li>
  <li>Change the owner and group for the JAR using the following comamand line instruction:<br />
<code>
chown cloudera-scm:cloudera-scm /opt/cloudera/csd/RECORD_SERVICE-1.0.jar
</code></li>
  <li>Update the permissions on the file using the following command line instruction:<br />
<code>
chmod 644 /opt/cloudera/csd/RECORD_SERVICE-1.0.jar
</code></li>
  <li>Restart the Cloudera Manager server
    <ol>
      <li>As the root user in the Cloudera Manager server, run <code>service cloudera-scm-server restart</code>.</li>
      <li>Log in to the Cloudera Manager Admin Console and restart the Cloudera Manager Service.</li>
    </ol>
  </li>
  <li>Check whether the CSD successfully installed in <code>http://{cm-server}:7180/cmf/csd/refresh</code>. Search for the following entry:</li>
</ol>

<p><code>
{
csdName: "RECORD_SERVICE-1.0",
serviceType: "RECORD_SERVICE",
source: "/opt/cloudera/csd/RECORD_SERVICE-1.0.jar",
isInstalled: true
}
</code></p>

<p>See <a href="http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_mc_addon_services.html">http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_mc_addon_services.html</a>.</p>

<h3 id="parcel-installation">Parcel Installation</h3>

<p>These are the steps to install the RecordService Parcel.</p>

<ol>
  <li>Go to <code>http://{cm-server}:7180/cmf/parcel/status</code>.</li>
  <li>Click <strong>Edit Settings</strong>.</li>
  <li>Add the RecordService repository url <code>http://archive.cloudera.com/beta/recordservice/parcels/latest</code> to <strong>Remote Parcel Repository URLs</strong>.</li>
  <li>Open the Cloudera Manager <strong>Parcel</strong> status page, <code>http://{cm-server}:7180/cmf/parcel/status</code>. </li>
  <li><strong>Download</strong> the RecordService parcel.</li>
  <li><strong>Distribute</strong> the parcel.</li>
  <li><strong>Activate</strong> the parcel. Cloudera Manager asks you to restart the entire cluster, but you only need to start/restart RecordService.</li>
</ol>

<p>See <a href="http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_ig_parcels.html">http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_ig_parcels.html</a></p>

<h3 id="cloudera-manager-deployment">Cloudera Manager Deployment</h3>

<p>There are the steps to start up RecordService for a cluster from Cloudera Manager.</p>

<ol>
  <li>Add a service from Cloudera Manager home page.</li>
  <li>Customize Role: 
    <ul>
      <li>RecordService Planner and Worker: Select nodes with both role of DN and NN.</li>
      <li>RecordService Planner: Select nodes with role of NN.</li>
      <li>RecordService Worker: Select nodes with role of DN.</li>
    </ul>
  </li>
  <li>Review and modify configuration settings, such as <em>log dir</em> and <em>planner port</em>.</li>
  <li>Start the service.</li>
  <li>Visit the debug page hostname:11050 to verify it started properly. </li>
  <li>Go to the RecordService cluster page in Cloudera Manager.</li>
  <li>Choose <strong>Deploy Client Configuration</strong> from <em>Actions</em>.</li>
  <li>Run the following command in the node where you run the RecordService client:</li>
</ol>

<p><code>
export HADOOP_CONF_DIR=/etc/hadoop/conf.cloudera.record_service
</code></p>

<p>See <a href="http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_mc_add_service.html?scroll=cmug_topic_5_1">http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cm_mc_add_service.html?scroll=cmug_topic_5_1</a>.</p>

<h3 id="recordservice-role-deployment-recommendations">RecordService Role Deployment Recommendations</h3>

<p><strong>RecordService Planner</strong> - Clients (MR/Spark) connect to the Planner to submit requests. Performs authorization checks and generates all tasks to execute for the overall request. For the beta release, run only one Planner node located on a non-DataNode.</p>

<p><strong>RecordService Worker</strong>: Read data from the underlying storage layer (HDFS/S3) and construct records. Worker roles cannot directly process client requests. Run a Worker on every DataNode in the cluster to ensure locality.</p>

<p><strong>RecordService Planner Worker</strong>: Acts as both a Planner and a Worker. Provides flexibility for small clusters. </p>

<p><strong>RecordService Gateway</strong>: Contains configuration information, such as the location of the RecordService Planner. Deploy to all Gateway nodes, and any other nodes that run client jobs that do not already have a RecordService Planner or Worker role deployed.</p>

<h3 id="run-a-job-using-recordservice">Run a Job Using RecordService</h3>

<p>You can verify the RecordService server installation by running examples from the client JAR.</p>

<ol>
  <li>Download the client library and example tarball. <a href="http://archive.cloudera.com/beta/recordservice/client-dist/recordservice-client-0.1-bin.tar.gz">http://archive.cloudera.com/beta/recordservice/client-dist/recordservice-client-0.1-bin.tar.gz</a>
    <ul>
      <li>You can also build the client library yourself from the client repository. <a href="http://github.mtv.cloudera.com/CDH/RecordServiceClient">http://github.mtv.cloudera.com/CDH/RecordServiceClient</a>.</li>
      <li>Client libraries are also available directly from Clouderaâ€™s public Maven repository.</li>
    </ul>
  </li>
  <li>To verify the server installation, you can run client examples in your clusters.</li>
</ol>

<li>Log in to one of the nodes in your cluster, and load test data:</li>

<p><code>
    &gt; wget -q --no-clobber \ 
      https://s3-us-west-1.amazonaws.com/recordservice-vm/tpch.tar.gz 
    &gt; tar -xzf tpch.tar.gz
    &gt; hadoop fs -mkdir -p /test-warehouse/tpch.nation
    &gt; hadoop fs -put -f tpch/nation/* /test-warehouse/tpch.nation/ 
    &gt; impala-shell -f create-tbls.sql
</code></p>

<p>See  <a href="https://github.com/cloudera/RecordServiceClient/blob/master/tests/create-tbls.sql">https://github.com/cloudera/RecordServiceClient/blob/master/tests/create-tbls.sql</a>.</p>

<li>Run a MapReduce job for RecordCount on tpch.nation:</li>

<p><code>
&gt; hadoop jar /path/to/recordservice-examples-0.1.jar \
com.cloudera.recordservice.examples.mapreduce.RecordCount \
"SELECT * FROM tpch.nation" "/tmp/recordcount_output"
</code></p>

<li>Start up spark-shell with the RecordService JAR:</li>

<p><code>
&gt; path/to/spark/bin/spark-shell \
--conf spark.recordservice.planner.hostports=planner_host:planner_port \
--jars /path/to/recordservice-examples-spark-0.1.jar
&gt; scala&gt; import com.cloudera.recordservice.spark._
import com.cloudera.recordservice.spark._
&gt; scala&gt; val data = sc.recordServiceRecords("select * from tpch.nation")
data: org.apache.spark.rdd.RDD[Array[org.apache.hadoop.io.Writable]] = \ RecordServiceRDD[0] at RDD at RecordServiceRDDBase.scala:57
&gt; scala&gt; data.count()
res0: Long = 25
</code></p>

<p>See <a href="http://github.mtv.cloudera.com/CDH/RecordServiceClient/blob/master/java/examples-spark/README.md">http://github.mtv.cloudera.com/CDH/RecordServiceClient/blob/master/java/examples-spark/README.md</a></p>

<h3 id="package-installation-not-recommended">Package Installation (Not Recommended)</h3>

<p>These are the steps to install RecordService from a package.</p>

<ol>
<li>Download package from <a href="http://archive.cloudera.com/beta/recordservice">http://archive.cloudera.com/beta/recordservice</a>.</li>
<li>Install Hadoop, Hive, Impala, Sentry, ZooKeeper and any other application you want to use.</li>
<li>Install the RecordServicePlanner using the following command line instruction:<br /><br />
<pre>
./recordserviced -hostname=hostname -recordservice_planner_port=12050 \
-recordservice_worker_port=0 -recordservice_webserver_port=11050 \
-webserver_doc_root=path/to/package/lib/recordservice \
-log_dir=path/to/log/dir -abort_on_config_error=false \
-lineage_event_log_dir=path/to/log/dir \
-audit_event_log_dir=path/to/log/dir -profile_log_dir=path/to/log/dir \
-v=1 -mem_limit=8G
</pre>
</li>
<br />
<li>Install the worker using the following command line instruction.
<br /><br />
<pre>
./recordserviced  -hostname=hostname -recordservice_planner_port=0 \
-recordservice_worker_port=13050 -recordservice_webserver_port=11050 \
-webserver_doc_root=path/to/package/lib/recordservice \
-log_dir=path/to/log/dir -abort_on_config_error=false \
-lineage_event_log_dir=path/to/log/dir \
-audit_event_log_dir=path/to/log/dir -profile_log_dir=path/to/log/dir \
-v=1 -mem_limit=8G
</pre>
</li>
<br />
<li>Install both planner and worker in one node:
<br /><br />
<pre>
./recordserviced -hostname=hostname -recordservice_planner_port=12050 \
-recordservice_worker_port=13050 -recordservice_webserver_port=11050 \
-webserver_doc_root=path/to/package/lib/recordservice \
-log_dir=path/to/log/dir -abort_on_config_error=false \
-lineage_event_log_dir=path/to/log/dir \
-audit_event_log_dir=path/to/log/dir -profile_log_dir=path/to/log/dir \
-v=1 -mem_limit=8G
</pre>
</li>
<br />
<li>Set additional parameters:
<ul>
<li>Add the following params if the cluster is kerberized:
<pre>
-principal=kerberos_principle -keytab_file=the/path/to/record_service.keytab
</pre></li>
<li>Add the Sentry configuration file, if applicable:
<br /><pre>
-sentry_config=path/to/sentry-site.xml/
</pre></li></ul>
    
</li></ol>
